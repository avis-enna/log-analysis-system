<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Security Operations Center - Real-time Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" rel="preload" as="script">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-dark: #1a1d29;
            --secondary-dark: #252836;
            --accent-blue: #00d4ff;
            --accent-green: #00ff88;
            --accent-red: #ff3366;
            --accent-orange: #ff8800;
            --text-primary: #ffffff;
            --text-secondary: #b4b7c9;
        }
        
        body {
            background: var(--primary-dark);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow-x: hidden;
        }
        
        .enterprise-header {
            background: linear-gradient(135deg, var(--secondary-dark) 0%, var(--primary-dark) 100%);
            border-bottom: 2px solid var(--accent-blue);
            padding: 1rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .sidebar {
            background: var(--secondary-dark);
            min-height: calc(100vh - 80px);
            border-right: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .nav-link {
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            margin: 0.25rem 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: rgba(0, 212, 255, 0.1);
            color: var(--accent-blue);
            border-left-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .main-content {
            background: var(--primary-dark);
            min-height: calc(100vh - 80px);
            padding: 2rem;
        }
        
        .soc-card {
            background: var(--secondary-dark);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .soc-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.15);
            border-color: var(--accent-blue);
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--secondary-dark), var(--primary-dark));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-blue);
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .threat-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .threat-critical { background: var(--accent-red); }
        .threat-high { background: var(--accent-orange); }
        .threat-medium { background: var(--accent-blue); }
        .threat-low { background: var(--accent-green); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .search-container {
            background: var(--secondary-dark);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
            transition: all 0.3s ease;
        }
        
        .search-container:focus-within {
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .search-input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            outline: none;
            width: 100%;
            padding: 0.5rem 0;
        }
        
        .search-input::placeholder {
            color: var(--text-secondary);
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin: 1rem 0;
        }
        
        .alert-item {
            background: rgba(255, 51, 102, 0.1);
            border-left: 4px solid var(--accent-red);
            border-radius: 0 8px 8px 0;
            padding: 1rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .alert-item:hover {
            background: rgba(255, 51, 102, 0.15);
            transform: translateX(5px);
        }
        
        .log-entry {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .log-entry:hover {
            background: rgba(0, 212, 255, 0.1);
            transform: translateX(3px);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-operational { 
            background: rgba(0, 255, 136, 0.2);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .status-degraded {
            background: rgba(255, 136, 0, 0.2);
            color: var(--accent-orange);
            border: 1px solid var(--accent-orange);
        }
        
        .status-critical {
            background: rgba(255, 51, 102, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }
        
        .system-status {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .progress-bar-custom {
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
    </style>
</head>
<body>
    <!-- Enterprise Header -->
    <div class="enterprise-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h2 class="mb-0">
                        <i class="fas fa-shield-alt me-2" style="color: var(--accent-blue);"></i>
                        Enterprise Security Operations Center
                    </h2>
                    <small class="text-muted">Real-time Threat Detection & Log Analysis Platform</small>
                </div>
                <div class="col-md-6 text-end">
                    <span class="status-badge status-operational me-3">
                        <i class="fas fa-circle me-1"></i>
                        OPERATIONAL
                    </span>
                    <span class="status-badge" style="background: rgba(0, 212, 255, 0.2); color: var(--accent-blue); border: 1px solid var(--accent-blue);">
                        <i class="fas fa-tachometer-alt me-1"></i>
                        <span id="eventsPerSecond">0</span> EPS
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Enhanced Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="p-3">
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="/">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            SOC Dashboard
                        </a>
                        <a class="nav-link" href="/search">
                            <i class="fas fa-search me-2"></i>
                            Advanced Search
                        </a>
                        <a class="nav-link" href="/alerts">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Security Alerts
                            <span class="badge" style="background: var(--accent-red); margin-left: auto;" id="alertCount">0</span>
                        </a>
                        <a class="nav-link" href="/analytics">
                            <i class="fas fa-chart-line me-2"></i>
                            Threat Analytics
                        </a>
                        <a class="nav-link" href="#" onclick="showCorrelationRules()">
                            <i class="fas fa-project-diagram me-2"></i>
                            Correlation Engine
                        </a>
                        <a class="nav-link" href="#" onclick="showIncidentResponse()">
                            <i class="fas fa-clipboard-list me-2"></i>
                            Incident Response
                        </a>
                        <a class="nav-link" href="#" onclick="showThreatIntel()">
                            <i class="fas fa-brain me-2"></i>
                            Threat Intelligence
                        </a>
                        <hr style="border-color: rgba(255,255,255,0.1); margin: 1rem 0;">
                        <a class="nav-link" href="#" onclick="showSystemHealth()">
                            <i class="fas fa-heart me-2"></i>
                            System Health
                        </a>
                        <a class="nav-link" href="#" onclick="showDataSources()">
                            <i class="fas fa-database me-2"></i>
                            Data Sources
                        </a>
                        <a class="nav-link" href="#" onclick="showNetworkTopology()">
                            <i class="fas fa-network-wired me-2"></i>
                            Network Topology
                        </a>
                        <a class="nav-link" href="#" onclick="enableRealTimeAlerts()">
                            <i class="fas fa-bell me-2"></i>
                            Real-time Alerts
                        </a>
                    </nav>
                    
                    <!-- System Status Panel -->
                    <div class="system-status">
                        <h6 class="mb-3" style="color: var(--accent-blue);">System Health</h6>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Log Ingestion</small>
                                <small>85%</small>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: 85%; background: var(--accent-green);"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Storage Usage</small>
                                <small>68%</small>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: 68%; background: var(--accent-orange);"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Threat Level</small>
                                <small>35%</small>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: 35%; background: var(--accent-red);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- Advanced Search Bar -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="search-container">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-search me-3" style="color: var(--accent-blue);"></i>
                                <input type="text" class="search-input" 
                                       placeholder="Search with SPL-like syntax: source=nginx AND level=ERROR | stats count by host"
                                       id="searchQuery">
                                <button class="btn btn-outline-primary ms-3" onclick="performAdvancedSearch()">
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-outline-success me-2" onclick="toggleRealTimeMode()">
                            <i class="fas fa-play me-1"></i>
                            Real-time
                        </button>
                        <button class="btn btn-outline-info" onclick="exportDashboard()">
                            <i class="fas fa-download me-1"></i>
                            Export
                        </button>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="metric-card p-3">
                            <div class="metric-value" id="totalEvents">0</div>
                            <div class="metric-label">Events Indexed</div>
                            <small class="text-muted">+<span id="eventsGrowth">0</span> today</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card p-3">
                            <div class="metric-value" style="color: var(--accent-red);" id="criticalThreats">0</div>
                            <div class="metric-label">Critical Threats</div>
                            <small class="text-muted">Requires immediate action</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card p-3">
                            <div class="metric-value" style="color: var(--accent-orange);" id="activeIncidents">0</div>
                            <div class="metric-label">Active Incidents</div>
                            <small class="text-muted">Under investigation</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card p-3">
                            <div class="metric-value" style="color: var(--accent-green);" id="dataSources">0</div>
                            <div class="metric-label">Data Sources</div>
                            <small class="text-muted">Connected & streaming</small>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0" style="color: var(--accent-blue);">
                                        <i class="fas fa-chart-line me-2"></i>
                                        Event Timeline - Real-time Analysis
                                    </h5>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary active" onclick="setTimeRange('1h')">1H</button>
                                        <button class="btn btn-outline-primary" onclick="setTimeRange('6h')">6H</button>
                                        <button class="btn btn-outline-primary" onclick="setTimeRange('24h')">24H</button>
                                        <button class="btn btn-outline-primary" onclick="setTimeRange('7d')">7D</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="timelineChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3">
                                <h5 class="mb-0" style="color: var(--accent-red);">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Threat Categories
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="threatChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Threat Intelligence & Incident Response Section -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-blue);">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    Threat Intelligence
                                </h5>
                                <button class="btn btn-sm btn-outline-primary" onclick="refreshThreatIntel()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="threatIntelligence">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-blue);"></div>
                                        Loading threat intelligence...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-orange);">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Incident Response
                                </h5>
                                <button class="btn btn-sm btn-outline-warning" onclick="createIncident()">
                                    <i class="fas fa-plus me-1"></i>
                                    New Incident
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="incidentResponse">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-orange);"></div>
                                        Loading incident data...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Correlation Engine & Event Timeline Section -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-green);">
                                    <i class="fas fa-sitemap me-2"></i>
                                    Correlation Engine
                                </h5>
                                <span class="badge bg-success">Active</span>
                            </div>
                            <div class="card-body">
                                <div id="correlationEngine">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-green);"></div>
                                        Loading correlation status...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-blue);">
                                    <i class="fas fa-clock me-2"></i>
                                    Event Timeline
                                </h5>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="changeTimelineRange(1)">1h</button>
                                    <button class="btn btn-outline-primary active" onclick="changeTimelineRange(6)">6h</button>
                                    <button class="btn btn-outline-primary" onclick="changeTimelineRange(24)">24h</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="eventTimeline" style="max-height: 300px; overflow-y: auto;">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-blue);"></div>
                                        Loading event timeline...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Critical Alerts & Events -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-red);">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    Critical Security Alerts
                                </h5>
                                <a href="/alerts" class="btn btn-sm btn-outline-danger">View All</a>
                            </div>
                            <div class="card-body">
                                <div id="criticalAlertsList">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-blue);"></div>
                                        Loading security alerts...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: var(--accent-blue);">
                                    <i class="fas fa-stream me-2"></i>
                                    Live Event Stream
                                </h5>
                                <a href="/search" class="btn btn-sm btn-outline-primary">Advanced Search</a>
                            </div>
                            <div class="card-body">
                                <div id="liveEventStream">
                                    <div class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm me-2" style="color: var(--accent-blue);"></div>
                                        Loading event stream...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Upload Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="soc-card">
                            <div class="card-header bg-transparent border-0 p-3">
                                <h5 class="mb-0" style="color: var(--accent-green);">
                                    <i class="fas fa-upload me-2"></i>
                                    Log Management
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- File Upload -->
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Upload Log File</h6>
                                        <form id="logUploadForm" enctype="multipart/form-data">
                                            <div class="mb-3">
                                                <input type="file" class="form-control" id="logFile" name="file" accept=".log,.txt,.csv">
                                                <div class="form-text">Supported formats: .log, .txt, .csv</div>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-upload me-1"></i>
                                                Upload Log File
                                            </button>
                                        </form>
                                        <div id="uploadStatus" class="mt-3"></div>
                                    </div>
                                    
                                    <!-- Manual Log Entry -->
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Add Manual Log Entry</h6>
                                        <form id="manualLogForm">
                                            <div class="row">
                                                <div class="col-6 mb-2">
                                                    <select class="form-select form-select-sm" id="logLevel">
                                                        <option value="INFO">INFO</option>
                                                        <option value="WARNING">WARNING</option>
                                                        <option value="ERROR">ERROR</option>
                                                        <option value="CRITICAL">CRITICAL</option>
                                                        <option value="DEBUG">DEBUG</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <input type="text" class="form-control form-control-sm" id="logSource" placeholder="Source" value="manual">
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <input type="text" class="form-control form-control-sm" id="logHost" placeholder="Host" value="localhost">
                                                </div>
                                                <div class="col-6 mb-2">
                                                    <input type="text" class="form-control form-control-sm" id="logCategory" placeholder="Category" value="application">
                                                </div>
                                                <div class="col-12 mb-3">
                                                    <textarea class="form-control form-control-sm" id="logMessage" rows="2" placeholder="Log message..."></textarea>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-outline-primary">
                                                <i class="fas fa-plus me-1"></i>
                                                Add Log Entry
                                            </button>
                                        </form>
                                        <div id="manualLogStatus" class="mt-3"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Details Modal -->
    <div class="modal fade" id="alertDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: var(--secondary-dark); border: 1px solid var(--accent-blue);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <h5 class="modal-title" style="color: var(--accent-blue);">Alert Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="alertDetailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 212, 255, 0.2);">
                    <button type="button" class="btn btn-outline-success" onclick="resolveCurrentAlert()">Resolve Alert</button>
                    <button type="button" class="btn btn-outline-warning" onclick="assignCurrentAlert()">Assign to Me</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Intelligence Modal -->
    <div class="modal fade" id="threatIntelModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background: var(--secondary-dark); border: 1px solid var(--accent-blue);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <h5 class="modal-title" style="color: var(--accent-blue);">
                        <i class="fas fa-brain me-2"></i>Threat Intelligence Dashboard
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">IOC Analysis</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6 text-center">
                                            <div class="h4 text-danger">247</div>
                                            <small class="text-muted">Malicious IPs</small>
                                        </div>
                                        <div class="col-6 text-center">
                                            <div class="h4 text-warning">89</div>
                                            <small class="text-muted">Suspicious URLs</small>
                                        </div>
                                    </div>
                                    <hr style="border-color: rgba(255,255,255,0.1);">
                                    <div class="threat-feed-item mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span class="fw-bold">192.168.1.100</span>
                                            <span class="badge bg-danger">High Risk</span>
                                        </div>
                                        <small class="text-muted">Known botnet C&C</small>
                                    </div>
                                    <div class="threat-feed-item mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span class="fw-bold">malware.exe</span>
                                            <span class="badge bg-warning">Medium Risk</span>
                                        </div>
                                        <small class="text-muted">Trojan detected</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Threat Feeds</h6>
                                </div>
                                <div class="card-body">
                                    <div class="feed-status mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>VirusTotal</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="feed-status mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>MISP</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="feed-status mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>AlienVault OTX</span>
                                            <span class="badge bg-warning">Delayed</span>
                                        </div>
                                    </div>
                                    <div class="feed-status mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Shodan</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Recent Intelligence</h6>
                                </div>
                                <div class="card-body">
                                    <div class="intel-item mb-3">
                                        <div class="fw-bold text-danger">APT29 Campaign</div>
                                        <small class="text-muted">New spearphishing campaign targeting financial sector</small>
                                        <div class="mt-1">
                                            <span class="badge bg-info">2 hours ago</span>
                                        </div>
                                    </div>
                                    <div class="intel-item mb-3">
                                        <div class="fw-bold text-warning">CVE-2024-12345</div>
                                        <small class="text-muted">Critical RCE vulnerability in Apache</small>
                                        <div class="mt-1">
                                            <span class="badge bg-info">4 hours ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 212, 255, 0.2);">
                    <button type="button" class="btn btn-outline-primary" onclick="exportThreatIntelReport()">
                        <i class="fas fa-download me-2"></i>Export Report
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="refreshThreatIntelData()">
                        <i class="fas fa-sync me-2"></i>Refresh Data
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Incident Response Modal -->
    <div class="modal fade" id="incidentResponseModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background: var(--secondary-dark); border: 1px solid var(--accent-blue);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <h5 class="modal-title" style="color: var(--accent-blue);">
                        <i class="fas fa-clipboard-list me-2"></i>Incident Response Center
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Active Incidents</h6>
                                </div>
                                <div class="card-body">
                                    <div class="incident-item mb-3 p-3" style="border: 1px solid var(--accent-red); border-radius: 8px;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="fw-bold text-danger">INC-2024-001</div>
                                                <div class="text-muted">Data Exfiltration Attempt</div>
                                                <small class="text-muted">Assigned to: John Doe</small>
                                            </div>
                                            <span class="badge bg-danger">Critical</span>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-primary me-2">View Details</button>
                                            <button class="btn btn-sm btn-outline-success">Update Status</button>
                                        </div>
                                    </div>
                                    <div class="incident-item mb-3 p-3" style="border: 1px solid var(--accent-orange); border-radius: 8px;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="fw-bold text-warning">INC-2024-002</div>
                                                <div class="text-muted">Suspicious Network Activity</div>
                                                <small class="text-muted">Assigned to: Jane Smith</small>
                                            </div>
                                            <span class="badge bg-warning">High</span>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-primary me-2">View Details</button>
                                            <button class="btn btn-sm btn-outline-success">Update Status</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Response Playbooks</h6>
                                </div>
                                <div class="card-body">
                                    <div class="playbook-item mb-3">
                                        <div class="fw-bold" style="color: var(--accent-blue);">Malware Infection Response</div>
                                        <small class="text-muted">Standard procedures for malware containment and eradication</small>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-info">Execute Playbook</button>
                                        </div>
                                    </div>
                                    <div class="playbook-item mb-3">
                                        <div class="fw-bold" style="color: var(--accent-blue);">DDoS Mitigation</div>
                                        <small class="text-muted">Automated DDoS detection and mitigation procedures</small>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-info">Execute Playbook</button>
                                        </div>
                                    </div>
                                    <div class="playbook-item mb-3">
                                        <div class="fw-bold" style="color: var(--accent-blue);">Data Breach Response</div>
                                        <small class="text-muted">Comprehensive data breach investigation and response</small>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-info">Execute Playbook</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="soc-card">
                                <div class="card-header">
                                    <h6 class="mb-0">Response Metrics</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 text-center">
                                            <div class="h4" style="color: var(--accent-blue);">2.5h</div>
                                            <small class="text-muted">Avg Response Time</small>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <div class="h4" style="color: var(--accent-green);">98.5%</div>
                                            <small class="text-muted">SLA Compliance</small>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <div class="h4" style="color: var(--accent-orange);">15</div>
                                            <small class="text-muted">Active Incidents</small>
                                        </div>
                                        <div class="col-md-3 text-center">
                                            <div class="h4" style="color: var(--accent-red);">3</div>
                                            <small class="text-muted">Critical Incidents</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 212, 255, 0.2);">
                    <button type="button" class="btn btn-outline-success" onclick="createNewIncident()">
                        <i class="fas fa-plus me-2"></i>Create New Incident
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="generateIncidentReport()">
                        <i class="fas fa-file-alt me-2"></i>Generate Report
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="executePlaybook()">
                        <i class="fas fa-play me-2"></i>Execute Playbook
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Correlation Engine Modal -->
    <div class="modal fade" id="correlationModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background: var(--secondary-dark); border: 1px solid var(--accent-blue);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 212, 255, 0.2);">
                    <h5 class="modal-title" style="color: var(--accent-blue);">
                        <i class="fas fa-project-diagram me-2"></i>Correlation Engine
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Engine Status</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Status:</span>
                                        <span class="badge bg-success">Running</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Active Rules:</span>
                                        <span class="fw-bold text-info">247</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Events/sec:</span>
                                        <span class="fw-bold text-success">1,234</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Memory Usage:</span>
                                        <span class="fw-bold text-warning">68%</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Uptime:</span>
                                        <span class="fw-bold">7d 12h 34m</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="soc-card h-100">
                                <div class="card-header">
                                    <h6 class="mb-0">Recent Correlations</h6>
                                </div>
                                <div class="card-body">
                                    <div class="correlation-item mb-3 p-3" style="border: 1px solid var(--accent-red); border-radius: 8px;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="fw-bold text-danger">Multi-stage Attack Detected</div>
                                                <div class="text-muted">Port scan → Login attempts → Data access</div>
                                                <small class="text-muted">Confidence: 95% | 15 events correlated</small>
                                            </div>
                                            <span class="badge bg-danger">Critical</span>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-primary">View Timeline</button>
                                            <button class="btn btn-sm btn-outline-warning">Create Alert</button>
                                        </div>
                                    </div>
                                    <div class="correlation-item mb-3 p-3" style="border: 1px solid var(--accent-orange); border-radius: 8px;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="fw-bold text-warning">Suspicious User Behavior</div>
                                                <div class="text-muted">Unusual login times and locations</div>
                                                <small class="text-muted">Confidence: 78% | 8 events correlated</small>
                                            </div>
                                            <span class="badge bg-warning">High</span>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-primary">View Timeline</button>
                                            <button class="btn btn-sm btn-outline-warning">Create Alert</button>
                                        </div>
                                    </div>
                                    <div class="correlation-item mb-3 p-3" style="border: 1px solid var(--accent-blue); border-radius: 8px;">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="fw-bold text-info">Network Anomaly</div>
                                                <div class="text-muted">Unusual traffic patterns detected</div>
                                                <small class="text-muted">Confidence: 65% | 23 events correlated</small>
                                            </div>
                                            <span class="badge bg-info">Medium</span>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-outline-primary">View Timeline</button>
                                            <button class="btn btn-sm btn-outline-warning">Create Alert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 212, 255, 0.2);">
                    <button type="button" class="btn btn-outline-success" onclick="addCorrelationRule()">
                        <i class="fas fa-plus me-2"></i>Add Rule
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="exportCorrelationConfig()">
                        <i class="fas fa-download me-2"></i>Export Config
                    </button>
                    <button type="button" class="btn btn-outline-warning" onclick="restartCorrelationEngine()">
                        <i class="fas fa-redo me-2"></i>Restart Engine
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Enterprise SOC Dashboard Controller
        class SOCDashboard {
            constructor() {
                this.charts = {};
                this.realTimeMode = true;
                this.refreshInterval = null;
                this.init();
            }

            init() {
                this.loadInitialData();
                this.loadAdditionalData();
                this.setupCharts();
                this.startRealTimeUpdates();
                this.bindEvents();
            }

            async loadInitialData() {
                try {
                    const [stats, alerts, logs] = await Promise.all([
                        fetch('/api/stats').then(r => r.json()),
                        fetch('/api/alerts?size=5').then(r => r.json()),
                        fetch('/api/logs?size=10').then(r => r.json())
                    ]);

                    this.updateMetrics(stats);
                    this.updateAlerts(alerts);
                    this.updateEventStream(logs);

                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                    this.showErrorState();
                }
            }

            updateMetrics(stats) {
                document.getElementById('totalEvents').textContent = stats.indexedEvents || stats.totalLogs.toLocaleString();
                document.getElementById('criticalThreats').textContent = stats.criticalAlerts || 0;
                document.getElementById('activeIncidents').textContent = stats.unresolvedAlerts || 0;
                document.getElementById('dataSources').textContent = stats.sources?.length || 0;
                document.getElementById('eventsPerSecond').textContent = stats.eventsPerSecond || 0;
                document.getElementById('alertCount').textContent = stats.unresolvedAlerts || 0;
                document.getElementById('eventsGrowth').textContent = (Math.random() * 1000 + 500).toFixed(0);
            }

            updateAlerts(alertData) {
                const container = document.getElementById('criticalAlertsList');
                const alerts = alertData.alerts || [];
                
                if (alerts.length === 0) {
                    container.innerHTML = '<div class="text-center py-3 text-muted">No critical alerts at this time</div>';
                    return;
                }

                container.innerHTML = alerts.map((alert, index) => `
                    <div class="alert-item" id="alert-${index}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="threat-indicator threat-${alert.severity.toLowerCase()}"></span>
                            <span class="status-badge status-${alert.resolved ? 'operational' : 'critical'}">
                                ${alert.severity}
                            </span>
                            <small class="text-muted">${new Date(alert.createdAt).toLocaleTimeString()}</small>
                        </div>
                        <div class="fw-bold mb-1">${alert.type}</div>
                        <div class="small text-muted">${alert.message}</div>
                        <div class="mt-2 d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">Risk Score: </small>
                                <span class="badge" style="background: var(--accent-orange);">${alert.riskScore}</span>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info btn-sm" onclick="viewAlertDetails(${index}, ${JSON.stringify(alert).replace(/"/g, '&quot;')})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="assignAlert(${index}, '${alert.id}')" title="Assign">
                                    <i class="fas fa-user-shield"></i>
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="resolveAlert(${index}, '${alert.id}')" title="Resolve">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            updateEventStream(logData) {
                const container = document.getElementById('liveEventStream');
                const logs = logData.logs || [];
                
                if (logs.length === 0) {
                    container.innerHTML = '<div class="text-center py-3 text-muted">No recent events</div>';
                    return;
                }

                container.innerHTML = logs.map(log => `
                    <div class="log-entry">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="badge" style="background: ${this.getLevelColor(log.level)}; color: white;">
                                ${log.level}
                            </span>
                            <small class="text-muted">${new Date(log.timestamp).toLocaleTimeString()}</small>
                        </div>
                        <div class="fw-bold small">${log.source} - ${log.host}</div>
                        <div class="small text-muted mt-1">${log.message.substring(0, 80)}${log.message.length > 80 ? '...' : ''}</div>
                    </div>
                `).join('');
            }

            async setupCharts() {
                await this.setupTimelineChart();
                await this.setupThreatChart();
            }

            async setupTimelineChart() {
                const response = await fetch('/api/charts/timeline');
                const data = await response.json();
                
                const ctx = document.getElementById('timelineChart').getContext('2d');
                
                this.charts.timeline = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${23-i}h ago`),
                        datasets: [
                            {
                                label: 'Critical',
                                data: Array.from({length: 24}, () => Math.floor(Math.random() * 50)),
                                borderColor: '#ff3366',
                                backgroundColor: 'rgba(255, 51, 102, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Warning',
                                data: Array.from({length: 24}, () => Math.floor(Math.random() * 200)),
                                borderColor: '#ff8800',
                                backgroundColor: 'rgba(255, 136, 0, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Info',
                                data: Array.from({length: 24}, () => Math.floor(Math.random() * 500) + 100),
                                borderColor: '#00d4ff',
                                backgroundColor: 'rgba(0, 212, 255, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' }
                            }
                        },
                        scales: {
                            x: { 
                                ticks: { color: '#b4b7c9' },
                                grid: { color: 'rgba(180, 183, 201, 0.1)' }
                            },
                            y: { 
                                ticks: { color: '#b4b7c9' },
                                grid: { color: 'rgba(180, 183, 201, 0.1)' }
                            }
                        }
                    }
                });
            }

            async setupThreatChart() {
                const response = await fetch('/api/charts/threats');
                const data = await response.json();
                
                const ctx = document.getElementById('threatChart').getContext('2d');
                
                this.charts.threats = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data.data || {}),
                        datasets: [{
                            data: Object.values(data.data || {}),
                            backgroundColor: [
                                '#ff3366',
                                '#ff8800', 
                                '#00d4ff',
                                '#00ff88',
                                '#8b5cf6'
                            ],
                            borderWidth: 2,
                            borderColor: '#1a1d29'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ffffff' },
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            startRealTimeUpdates() {
                if (this.refreshInterval) return;
                
                this.refreshInterval = setInterval(() => {
                    if (this.realTimeMode) {
                        this.loadInitialData();
                    }
                }, 5000); // Update every 5 seconds
            }

            stopRealTimeUpdates() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
            }

            toggleRealTimeMode() {
                this.realTimeMode = !this.realTimeMode;
                const btn = document.querySelector('[onclick="toggleRealTimeMode()"]');
                
                if (this.realTimeMode) {
                    btn.innerHTML = '<i class="fas fa-pause me-1"></i>Pause';
                    btn.className = 'btn btn-outline-warning me-2';
                    this.startRealTimeUpdates();
                } else {
                    btn.innerHTML = '<i class="fas fa-play me-1"></i>Resume';
                    btn.className = 'btn btn-outline-success me-2';
                    this.stopRealTimeUpdates();
                }
            }

            getLevelColor(level) {
                const colors = {
                    'CRITICAL': '#ff3366',
                    'ERROR': '#ff3366',
                    'WARNING': '#ff8800',
                    'INFO': '#00d4ff',
                    'DEBUG': '#00ff88'
                };
                return colors[level] || '#b4b7c9';
            }

            showErrorState() {
                document.getElementById('criticalAlertsList').innerHTML = 
                    '<div class="text-center py-3 text-danger">Failed to load alerts</div>';
                document.getElementById('liveEventStream').innerHTML = 
                    '<div class="text-center py-3 text-danger">Failed to load events</div>';
            }

            bindEvents() {
                // Bind search functionality
                document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performAdvancedSearch();
                    }
                });

                // Bind log upload form submission
                document.getElementById('logUploadForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.uploadLogFile();
                });

                // Bind manual log entry form submission
                document.getElementById('manualLogForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addManualLogEntry();
                });
            }

            performAdvancedSearch() {
                const query = document.getElementById('searchQuery').value;
                if (query.trim()) {
                    window.location.href = `/search?q=${encodeURIComponent(query)}`;
                }
            }

            async loadAdditionalData() {
                try {
                    const [threatIntel, incidentResponse, correlationEngine, eventTimeline] = await Promise.all([
                        fetch('/api/analytics/threat-intelligence').then(r => r.json()),
                        fetch('/api/incident-response/dashboard').then(r => r.json()),
                        fetch('/api/correlation/engine-status').then(r => r.json()),
                        fetch('/api/timeline/events?hours=6').then(r => r.json())
                    ]);

                    this.updateThreatIntelligence(threatIntel);
                    this.updateIncidentResponse(incidentResponse);
                    this.updateCorrelationEngine(correlationEngine);
                    this.updateEventTimeline(eventTimeline);

                } catch (error) {
                    console.error('Failed to load additional data:', error);
                }
            }

            updateThreatIntelligence(data) {
                const container = document.getElementById('threatIntelligence');
                const indicators = data.indicators || [];
                const feeds = data.feeds || {};
                const iocStats = data.iocStats || {};

                container.innerHTML = `
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-blue);">${iocStats.totalIOCs?.toLocaleString() || 0}</div>
                                <small class="text-muted">Total IOCs</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-green);">${feeds.activeFeeds || 0}</div>
                                <small class="text-muted">Active Feeds</small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 class="mb-2">Recent Indicators</h6>
                        ${indicators.slice(0, 3).map(indicator => `
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2" style="background: rgba(0,0,0,0.2); border-radius: 4px;">
                                <div>
                                    <small class="text-muted">${indicator.type}</small>
                                    <div class="fw-bold" style="font-size: 0.9em;">${indicator.value}</div>
                                </div>
                                <span class="badge" style="background: ${indicator.confidence === 'High' ? 'var(--accent-red)' : indicator.confidence === 'Medium' ? 'var(--accent-orange)' : 'var(--accent-green)'};">
                                    ${indicator.confidence}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <small class="text-muted">Last updated: ${new Date(data.lastAnalysis).toLocaleTimeString()}</small>
                    </div>
                `;
            }

            updateIncidentResponse(data) {
                const container = document.getElementById('incidentResponse');
                const incidents = data.activeIncidents || [];
                const metrics = data.metrics || {};

                container.innerHTML = `
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-orange);">${incidents.length}</div>
                                <small class="text-muted">Active Incidents</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-blue);">${metrics.avgResponseTime || 'N/A'}</div>
                                <small class="text-muted">Avg Response</small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 class="mb-2">Recent Incidents</h6>
                        ${incidents.slice(0, 3).map(incident => `
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2" style="background: rgba(0,0,0,0.2); border-radius: 4px;">
                                <div>
                                    <div class="fw-bold" style="font-size: 0.9em;">${incident.id}</div>
                                    <small class="text-muted">${incident.title}</small>
                                </div>
                                <span class="badge" style="background: ${incident.severity === 'Critical' ? 'var(--accent-red)' : incident.severity === 'High' ? 'var(--accent-orange)' : 'var(--accent-green)'};">
                                    ${incident.severity}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            updateCorrelationEngine(data) {
                const container = document.getElementById('correlationEngine');
                const engineStats = data.engineStats || {};
                const recentCorrelations = data.recentCorrelations || [];

                container.innerHTML = `
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-green);">${engineStats.activeRules || 0}</div>
                                <small class="text-muted">Active Rules</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <div class="h4 mb-1" style="color: var(--accent-blue);">${engineStats.correlationsFound || 0}</div>
                                <small class="text-muted">Correlations</small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <h6 class="mb-2">Recent Correlations</h6>
                        ${recentCorrelations.slice(0, 3).map(correlation => `
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2" style="background: rgba(0,0,0,0.2); border-radius: 4px;">
                                <div>
                                    <div class="fw-bold" style="font-size: 0.9em;">${correlation.id}</div>
                                    <small class="text-muted">${correlation.description}</small>
                                </div>
                                <span class="badge bg-info">${correlation.eventCount} events</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Status: ${engineStats.status || 'Unknown'}</small>
                        <small class="text-muted">Uptime: ${engineStats.uptime || 'N/A'}</small>
                    </div>
                `;
            }

            updateEventTimeline(data) {
                const container = document.getElementById('eventTimeline');
                const events = data.events || [];
                const stats = data.statistics || {};

                container.innerHTML = `
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-4 text-center">
                                <div class="fw-bold" style="color: var(--accent-blue);">${stats.totalEvents || 0}</div>
                                <small class="text-muted">Total Events</small>
                            </div>
                            <div class="col-4 text-center">
                                <div class="fw-bold" style="color: var(--accent-red);">${stats.criticalEvents || 0}</div>
                                <small class="text-muted">Critical</small>
                            </div>
                            <div class="col-4 text-center">
                                <div class="fw-bold" style="color: var(--accent-orange);">${stats.securityEvents || 0}</div>
                                <small class="text-muted">Security</small>
                            </div>
                        </div>
                    </div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${events.slice(0, 10).map(event => {
                            const iconClass = event.severity === 'danger' ? 'fas fa-exclamation-triangle' :
                                            event.severity === 'warning' ? 'fas fa-exclamation-circle' :
                                            event.severity === 'success' ? 'fas fa-check-circle' : 'fas fa-info-circle';
                            const iconColor = event.severity === 'danger' ? 'var(--accent-red)' :
                                            event.severity === 'warning' ? 'var(--accent-orange)' :
                                            event.severity === 'success' ? 'var(--accent-green)' : 'var(--accent-blue)';
                            
                            return `
                                <div class="d-flex align-items-start mb-2 p-2" style="background: rgba(0,0,0,0.1); border-radius: 4px;">
                                    <i class="${iconClass} me-2 mt-1" style="color: ${iconColor}; font-size: 0.8em;"></i>
                                    <div class="flex-grow-1">
                                        <div style="font-size: 0.85em;" class="fw-bold">${event.type}</div>
                                        <div style="font-size: 0.75em;" class="text-muted">${event.description}</div>
                                        <small class="text-muted">${new Date(event.timestamp).toLocaleTimeString()}</small>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            async refreshAllData() {
                await this.loadInitialData();
                await this.loadAdditionalData();
            }
            
            // Log Upload Functionality
            async uploadLogFile() {
                const form = document.getElementById('logUploadForm');
                const fileInput = document.getElementById('logFile');
                const statusDiv = document.getElementById('uploadStatus');
                
                if (!fileInput.files[0]) {
                    statusDiv.innerHTML = '<div class="text-warning">Please select a file to upload.</div>';
                    return;
                }
                
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                statusDiv.innerHTML = '<div class="text-info"><i class="fas fa-spinner fa-spin me-2"></i>Uploading...</div>';
                
                try {
                    const response = await fetch('/api/logs/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        statusDiv.innerHTML = `
                            <div class="text-success">
                                <i class="fas fa-check me-2"></i>
                                File uploaded successfully!<br>
                                <small>Processed: ${result.processedLines} lines, Errors: ${result.errors}</small>
                            </div>
                        `;
                        form.reset();
                        // Refresh dashboard data to show new logs
                        setTimeout(() => this.loadInitialData(), 1000);
                    } else {
                        statusDiv.innerHTML = `<div class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>${result.message}</div>`;
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    statusDiv.innerHTML = '<div class="text-danger">Upload failed. Please try again.</div>';
                }
            }
            
            async addManualLogEntry() {
                const level = document.getElementById('logLevel').value;
                const source = document.getElementById('logSource').value;
                const host = document.getElementById('logHost').value;
                const category = document.getElementById('logCategory').value;
                const message = document.getElementById('logMessage').value;
                const statusDiv = document.getElementById('manualLogStatus');
                
                if (!message.trim()) {
                    statusDiv.innerHTML = '<div class="text-warning">Please enter a log message.</div>';
                    return;
                }
                
                statusDiv.innerHTML = '<div class="text-info"><i class="fas fa-spinner fa-spin me-2"></i>Adding log entry...</div>';
                
                try {
                    const response = await fetch('/api/logs/manual', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            level: level,
                            source: source,
                            host: host,
                            category: category,
                            message: message
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        statusDiv.innerHTML = `
                            <div class="text-success">
                                <i class="fas fa-check me-2"></i>
                                Log entry added successfully!<br>
                                <small>ID: ${result.logId}</small>
                            </div>
                        `;
                        document.getElementById('manualLogForm').reset();
                        // Reset to default values
                        document.getElementById('logSource').value = 'manual';
                        document.getElementById('logHost').value = 'localhost';
                        document.getElementById('logCategory').value = 'application';
                        // Refresh dashboard data to show new log
                        setTimeout(() => this.loadInitialData(), 1000);
                    } else {
                        statusDiv.innerHTML = `<div class="text-danger"><i class="fas fa-exclamation-triangle me-2"></i>${result.message}</div>`;
                    }
                } catch (error) {
                    console.error('Add log entry error:', error);
                    statusDiv.innerHTML = '<div class="text-danger">Failed to add log entry. Please try again.</div>';
                }
            }
        }

        // Global functions for button handlers
        function toggleRealTimeMode() {
            window.socDashboard.toggleRealTimeMode();
        }

        function performAdvancedSearch() {
            window.socDashboard.performAdvancedSearch();
        }

        // Additional global functions for new features
        async function refreshThreatIntel() {
            try {
                const response = await fetch('/api/analytics/threat-intelligence');
                const data = await response.json();
                window.socDashboard.updateThreatIntelligence(data);
            } catch (error) {
                console.error('Failed to refresh threat intelligence:', error);
            }
        }

        async function createIncident() {
            const title = prompt('Enter incident title:');
            if (!title) return;

            const severity = prompt('Enter severity (Critical/High/Medium/Low):') || 'Medium';
            
            try {
                const response = await fetch('/api/incident-response/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, severity })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`Incident created: ${result.incidentId}`);
                    // Refresh incident response data
                    const incidentResponse = await fetch('/api/incident-response/dashboard').then(r => r.json());
                    window.socDashboard.updateIncidentResponse(incidentResponse);
                }
            } catch (error) {
                console.error('Failed to create incident:', error);
                alert('Failed to create incident. Please try again.');
            }
        }

        let currentTimelineRange = 6;
        async function changeTimelineRange(hours) {
            currentTimelineRange = hours;
            
            // Update active button
            document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            try {
                const response = await fetch(`/api/timeline/events?hours=${hours}`);
                const data = await response.json();
                window.socDashboard.updateEventTimeline(data);
            } catch (error) {
                console.error('Failed to change timeline range:', error);
            }
        }

        // Global variables for current alert context
        let currentAlertIndex = null;
        let currentAlertId = null;

        // Alert action functions
        function viewAlertDetails(index, alertData) {
            currentAlertIndex = index;
            currentAlertId = alertData.id;
            
            const content = document.getElementById('alertDetailsContent');
            content.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="mb-3" style="color: var(--accent-blue);">Alert Information</h6>
                        <table class="table table-dark table-borderless">
                            <tr><td><strong>ID:</strong></td><td>${alertData.id}</td></tr>
                            <tr><td><strong>Type:</strong></td><td>${alertData.type}</td></tr>
                            <tr><td><strong>Severity:</strong></td><td><span class="badge bg-${alertData.severity.toLowerCase()}">${alertData.severity}</span></td></tr>
                            <tr><td><strong>Risk Score:</strong></td><td>${alertData.riskScore}</td></tr>
                            <tr><td><strong>Created:</strong></td><td>${new Date(alertData.createdAt).toLocaleString()}</td></tr>
                            <tr><td><strong>Status:</strong></td><td>${alertData.resolved ? 'Resolved' : 'Active'}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="mb-3" style="color: var(--accent-blue);">Technical Details</h6>
                        <div class="soc-card">
                            <div class="card-body">
                                <p><strong>Message:</strong></p>
                                <p class="text-muted">${alertData.message}</p>
                                <p><strong>Affected Assets:</strong></p>
                                <ul class="text-muted">
                                    <li>Host: ${alertData.host || 'N/A'}</li>
                                    <li>Source: ${alertData.source || 'N/A'}</li>
                                    <li>Category: ${alertData.category || 'Security'}</li>
                                </ul>
                                <p><strong>Recommended Actions:</strong></p>
                                <ul class="text-muted">
                                    <li>Investigate source IP/system</li>
                                    <li>Check for related events</li>
                                    <li>Update security policies if needed</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('alertDetailsModal')).show();
        }

        function assignAlert(index, alertId) {
            currentAlertIndex = index;
            currentAlertId = alertId;
            
            // Simulate assignment
            const alertElement = document.getElementById(`alert-${index}`);
            if (alertElement) {
                // Add visual feedback
                alertElement.style.borderLeft = '4px solid var(--accent-blue)';
                
                // Show success message
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });
                
                Toast.fire({
                    icon: 'success',
                    title: `Alert ${alertId} assigned to you`,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)'
                });
            }
        }

        function resolveAlert(index, alertId) {
            currentAlertIndex = index;
            currentAlertId = alertId;
            
            // Simulate resolution
            const alertElement = document.getElementById(`alert-${index}`);
            if (alertElement) {
                // Add visual feedback
                alertElement.style.opacity = '0.6';
                alertElement.style.borderLeft = '4px solid var(--accent-green)';
                
                // Update status badge
                const statusBadge = alertElement.querySelector('.status-badge');
                if (statusBadge) {
                    statusBadge.textContent = 'RESOLVED';
                    statusBadge.className = 'status-badge status-operational';
                }
                
                // Disable action buttons
                const buttons = alertElement.querySelectorAll('.btn-group button');
                buttons.forEach(btn => btn.disabled = true);
                
                // Show success message
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true
                });
                
                Toast.fire({
                    icon: 'success',
                    title: `Alert ${alertId} resolved successfully`,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)'
                });
            }
        }

        function resolveCurrentAlert() {
            if (currentAlertIndex !== null && currentAlertId !== null) {
                resolveAlert(currentAlertIndex, currentAlertId);
                bootstrap.Modal.getInstance(document.getElementById('alertDetailsModal')).hide();
            }
        }

        function assignCurrentAlert() {
            if (currentAlertIndex !== null && currentAlertId !== null) {
                assignAlert(currentAlertIndex, currentAlertId);
                bootstrap.Modal.getInstance(document.getElementById('alertDetailsModal')).hide();
            }
        }

        function exportDashboard() {
            console.log('Exporting dashboard data...');
            
            // Simulate export functionality
            const exportData = {
                timestamp: new Date().toISOString(),
                metrics: {
                    totalEvents: document.getElementById('totalEvents').textContent,
                    criticalThreats: document.getElementById('criticalThreats').textContent,
                    activeIncidents: document.getElementById('activeIncidents').textContent,
                    dataSources: document.getElementById('dataSources').textContent
                },
                alerts: [], // Would contain actual alert data
                logs: [] // Would contain actual log data
            };
            
            // Create and download file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `soc-dashboard-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            // Show success message
            Swal.fire({
                icon: 'success',
                title: 'Dashboard Exported',
                text: 'Dashboard data has been exported successfully',
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)'
            });
        }

        function showCorrelationRules() {
            new bootstrap.Modal(document.getElementById('correlationModal')).show();
        }

        function showIncidentResponse() {
            new bootstrap.Modal(document.getElementById('incidentResponseModal')).show();
        }

        function showThreatIntel() {
            new bootstrap.Modal(document.getElementById('threatIntelModal')).show();
        }

        // Threat Intelligence Functions
        async function exportThreatIntelReport() {
            try {
                const response = await fetch('/api/analytics/threat-intelligence');
                const data = await response.json();
                
                const reportData = {
                    timestamp: new Date().toISOString(),
                    threatIntelligence: data,
                    summary: {
                        totalIOCs: data.iocStats?.totalIOCs || 0,
                        activeFeeds: data.feeds?.activeFeeds || 0,
                        indicators: data.indicators?.length || 0
                    }
                };
                
                const dataStr = JSON.stringify(reportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `threat-intel-report-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                Swal.fire({
                    icon: 'success',
                    title: 'Report Exported',
                    text: 'Threat intelligence report has been downloaded',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-blue)'
                });
            } catch (error) {
                console.error('Export error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Export Failed',
                    text: 'Failed to export threat intelligence report',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-red)'
                });
            }
        }

        async function refreshThreatIntelData() {
            try {
                const response = await fetch('/api/analytics/threat-intelligence');
                const data = await response.json();
                window.socDashboard.updateThreatIntelligence(data);
                
                Swal.fire({
                    icon: 'success',
                    title: 'Data Refreshed',
                    text: 'Threat intelligence data has been updated',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)'
                });
            } catch (error) {
                console.error('Refresh error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Refresh Failed',
                    text: 'Failed to refresh threat intelligence data',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-red)'
                });
            }
        }

        // Incident Response Functions
        async function createNewIncident() {
            const { value: formValues } = await Swal.fire({
                title: 'Create New Incident',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label for="incident-title" class="form-label">Incident Title</label>
                            <input type="text" id="incident-title" class="form-control" placeholder="Enter incident title">
                        </div>
                        <div class="mb-3">
                            <label for="incident-severity" class="form-label">Severity</label>
                            <select id="incident-severity" class="form-select">
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="incident-description" class="form-label">Description</label>
                            <textarea id="incident-description" class="form-control" rows="3" placeholder="Describe the incident"></textarea>
                        </div>
                    </div>
                `,
                focusConfirm: false,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                showCancelButton: true,
                preConfirm: () => {
                    const title = document.getElementById('incident-title').value;
                    const severity = document.getElementById('incident-severity').value;
                    const description = document.getElementById('incident-description').value;
                    
                    if (!title) {
                        Swal.showValidationMessage('Please enter an incident title');
                        return false;
                    }
                    
                    return { title, severity, description };
                }
            });

            if (formValues) {
                try {
                    const response = await fetch('/api/incident-response/create', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formValues)
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Incident Created',
                            text: `Incident ${result.incidentId} created successfully`,
                            background: 'var(--secondary-dark)',
                            color: 'var(--text-primary)',
                            confirmButtonColor: 'var(--accent-blue)'
                        });
                        
                        // Refresh incident response data
                        const incidentResponse = await fetch('/api/incident-response/dashboard').then(r => r.json());
                        window.socDashboard.updateIncidentResponse(incidentResponse);
                    } else {
                        throw new Error(result.message || 'Failed to create incident');
                    }
                } catch (error) {
                    console.error('Create incident error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Creation Failed',
                        text: 'Failed to create incident. Please try again.',
                        background: 'var(--secondary-dark)',
                        color: 'var(--text-primary)',
                        confirmButtonColor: 'var(--accent-red)'
                    });
                }
            }
        }

        async function generateIncidentReport() {
            try {
                const response = await fetch('/api/incident-response/dashboard');
                const data = await response.json();
                
                const reportData = {
                    timestamp: new Date().toISOString(),
                    incidentSummary: {
                        activeIncidents: data.activeIncidents?.length || 0,
                        avgResponseTime: data.metrics?.avgResponseTime || 'N/A',
                        totalIncidents: data.activeIncidents?.length || 0
                    },
                    incidents: data.activeIncidents || [],
                    metrics: data.metrics || {}
                };
                
                const dataStr = JSON.stringify(reportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `incident-response-report-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                Swal.fire({
                    icon: 'success',
                    title: 'Report Generated',
                    text: 'Incident response report has been downloaded',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-blue)'
                });
            } catch (error) {
                console.error('Generate report error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Generation Failed',
                    text: 'Failed to generate incident report',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-red)'
                });
            }
        }

        async function executePlaybook() {
            const { value: playbook } = await Swal.fire({
                title: 'Execute Security Playbook',
                input: 'select',
                inputOptions: {
                    'malware-response': 'Malware Infection Response',
                    'ddos-mitigation': 'DDoS Mitigation',
                    'data-breach': 'Data Breach Response',
                    'phishing-response': 'Phishing Attack Response',
                    'unauthorized-access': 'Unauthorized Access Response'
                },
                inputPlaceholder: 'Select a playbook',
                showCancelButton: true,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Please select a playbook to execute';
                    }
                }
            });

            if (playbook) {
                Swal.fire({
                    title: 'Executing Playbook',
                    html: `
                        <div class="text-start">
                            <p>Executing: <strong>${playbook.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong></p>
                            <div class="progress mb-3">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <div id="playbook-steps">
                                <div class="mb-2">
                                    <i class="fas fa-spinner fa-spin me-2"></i>
                                    Initializing automated response...
                                </div>
                            </div>
                        </div>
                    `,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    showConfirmButton: false,
                    allowOutsideClick: false
                });

                // Simulate playbook execution
                const steps = [
                    'Analyzing threat indicators...',
                    'Isolating affected systems...',
                    'Collecting forensic evidence...',
                    'Applying containment measures...',
                    'Notifying stakeholders...',
                    'Generating incident report...'
                ];

                for (let i = 0; i < steps.length; i++) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const progress = ((i + 1) / steps.length) * 100;
                    document.querySelector('.progress-bar').style.width = `${progress}%`;
                    
                    document.getElementById('playbook-steps').innerHTML = steps.slice(0, i + 1).map((step, idx) => `
                        <div class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            ${step}
                        </div>
                    `).join('') + (i < steps.length - 1 ? `
                        <div class="mb-2">
                            <i class="fas fa-spinner fa-spin me-2"></i>
                            ${steps[i + 1]}
                        </div>
                    ` : '');
                }

                await new Promise(resolve => setTimeout(resolve, 1000));

                Swal.fire({
                    icon: 'success',
                    title: 'Playbook Executed',
                    text: `${playbook.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())} playbook completed successfully`,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-green)'
                });
            }
        }

        // Correlation Engine Functions
        async function addCorrelationRule() {
            const { value: formValues } = await Swal.fire({
                title: 'Add Correlation Rule',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label for="rule-name" class="form-label">Rule Name</label>
                            <input type="text" id="rule-name" class="form-control" placeholder="Enter rule name">
                        </div>
                        <div class="mb-3">
                            <label for="rule-pattern" class="form-label">Event Pattern</label>
                            <textarea id="rule-pattern" class="form-control" rows="3" 
                                      placeholder="e.g., failed_login_count > 5 AND timeframe < 5min"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="rule-severity" class="form-label">Alert Severity</label>
                            <select id="rule-severity" class="form-select">
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                                <option value="CRITICAL">Critical</option>
                            </select>
                        </div>
                    </div>
                `,
                focusConfirm: false,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                showCancelButton: true,
                preConfirm: () => {
                    const name = document.getElementById('rule-name').value;
                    const pattern = document.getElementById('rule-pattern').value;
                    const severity = document.getElementById('rule-severity').value;
                    
                    if (!name || !pattern) {
                        Swal.showValidationMessage('Please fill in all required fields');
                        return false;
                    }
                    
                    return { name, pattern, severity };
                }
            });

            if (formValues) {
                try {
                    // Simulate API call to add correlation rule
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Rule Added',
                        text: `Correlation rule "${formValues.name}" has been added successfully`,
                        background: 'var(--secondary-dark)',
                        color: 'var(--text-primary)',
                        confirmButtonColor: 'var(--accent-blue)'
                    });
                    
                    // Refresh correlation engine data
                    const correlationData = await fetch('/api/correlation/engine-status').then(r => r.json());
                    window.socDashboard.updateCorrelationEngine(correlationData);
                } catch (error) {
                    console.error('Add rule error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Failed to Add Rule',
                        text: 'Failed to add correlation rule. Please try again.',
                        background: 'var(--secondary-dark)',
                        color: 'var(--text-primary)',
                        confirmButtonColor: 'var(--accent-red)'
                    });
                }
            }
        }

        async function exportCorrelationConfig() {
            try {
                const response = await fetch('/api/correlation/engine-status');
                const data = await response.json();
                
                const configData = {
                    timestamp: new Date().toISOString(),
                    engineStatus: data.engineStats || {},
                    correlationRules: data.recentCorrelations || [],
                    configuration: {
                        activeRules: data.engineStats?.activeRules || 0,
                        correlationsFound: data.engineStats?.correlationsFound || 0,
                        uptime: data.engineStats?.uptime || 'N/A'
                    }
                };
                
                const dataStr = JSON.stringify(configData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `correlation-config-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                Swal.fire({
                    icon: 'success',
                    title: 'Configuration Exported',
                    text: 'Correlation engine configuration has been downloaded',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-blue)'
                });
            } catch (error) {
                console.error('Export config error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Export Failed',
                    text: 'Failed to export correlation configuration',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-red)'
                });
            }
        }

        async function restartCorrelationEngine() {
            const result = await Swal.fire({
                title: 'Restart Correlation Engine',
                text: 'Are you sure you want to restart the correlation engine? This will temporarily stop correlation processing.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: 'var(--accent-orange)',
                cancelButtonColor: 'var(--accent-gray)',
                confirmButtonText: 'Yes, restart it!',
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)'
            });

            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Restarting Engine',
                    html: `
                        <div class="text-center">
                            <i class="fas fa-spinner fa-spin fa-3x mb-3" style="color: var(--accent-orange);"></i>
                            <p>Restarting correlation engine...</p>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 100%"></div>
                            </div>
                        </div>
                    `,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    showConfirmButton: false,
                    allowOutsideClick: false
                });

                // Simulate restart process
                await new Promise(resolve => setTimeout(resolve, 3000));

                Swal.fire({
                    icon: 'success',
                    title: 'Engine Restarted',
                    text: 'Correlation engine has been restarted successfully',
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-green)'
                });

                // Refresh correlation engine data
                const correlationData = await fetch('/api/correlation/engine-status').then(r => r.json());
                window.socDashboard.updateCorrelationEngine(correlationData);
            }
        }

        // Dashboard Time Range Functions
        function setTimeRange(range) {
            // Update active button
            document.querySelectorAll('[onclick*="setTimeRange"]').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Simulate data update based on time range
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)'
            });
            
            Toast.fire({
                icon: 'info',
                title: `Time range updated to ${range.toUpperCase()}`
            });

            // Refresh charts and data
            window.socDashboard.setupCharts();
        }

        // Advanced Dashboard Features
        async function showSystemHealth() {
            const healthData = {
                cpu: Math.floor(Math.random() * 30) + 50,
                memory: Math.floor(Math.random() * 25) + 60,
                disk: Math.floor(Math.random() * 20) + 70,
                network: Math.floor(Math.random() * 15) + 80
            };

            Swal.fire({
                title: 'System Health Status',
                html: `
                    <div class="row text-start">
                        <div class="col-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>CPU Usage</span>
                                <span class="fw-bold">${healthData.cpu}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${healthData.cpu}%; background-color: ${healthData.cpu > 80 ? 'var(--accent-red)' : 'var(--accent-green)'}"></div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>Memory Usage</span>
                                <span class="fw-bold">${healthData.memory}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${healthData.memory}%; background-color: ${healthData.memory > 80 ? 'var(--accent-red)' : 'var(--accent-green)'}"></div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>Disk Usage</span>
                                <span class="fw-bold">${healthData.disk}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${healthData.disk}%; background-color: ${healthData.disk > 80 ? 'var(--accent-red)' : 'var(--accent-green)'}"></div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>Network I/O</span>
                                <span class="fw-bold">${healthData.network}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${healthData.network}%; background-color: ${healthData.network > 80 ? 'var(--accent-red)' : 'var(--accent-green)'}"></div>
                            </div>
                        </div>
                    </div>
                `,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                width: '600px'
            });
        }

        async function showDataSources() {
            const dataSources = [
                { name: 'Windows Event Logs', status: 'Active', events: '1,247/min', health: 'good' },
                { name: 'Apache Access Logs', status: 'Active', events: '892/min', health: 'good' },
                { name: 'Firewall Logs', status: 'Active', events: '2,156/min', health: 'good' },
                { name: 'DNS Query Logs', status: 'Delayed', events: '456/min', health: 'warning' },
                { name: 'IDS/IPS Alerts', status: 'Active', events: '89/min', health: 'good' },
                { name: 'Database Audit Logs', status: 'Error', events: '0/min', health: 'error' }
            ];

            Swal.fire({
                title: 'Data Sources Status',
                html: `
                    <div class="table-responsive">
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Status</th>
                                    <th>Events/Min</th>
                                    <th>Health</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dataSources.map(source => `
                                    <tr>
                                        <td>${source.name}</td>
                                        <td>
                                            <span class="badge bg-${source.status === 'Active' ? 'success' : source.status === 'Delayed' ? 'warning' : 'danger'}">
                                                ${source.status}
                                            </span>
                                        </td>
                                        <td>${source.events}</td>
                                        <td>
                                            <i class="fas fa-circle" style="color: ${source.health === 'good' ? 'var(--accent-green)' : source.health === 'warning' ? 'var(--accent-orange)' : 'var(--accent-red)'}"></i>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                width: '700px'
            });
        }

        async function showNetworkTopology() {
            Swal.fire({
                title: 'Network Topology',
                html: `
                    <div class="text-center">
                        <div class="network-diagram mb-4">
                            <div class="row justify-content-center">
                                <div class="col-auto">
                                    <div class="network-node" style="background: var(--accent-blue); padding: 10px; border-radius: 50%; margin: 10px;">
                                        <i class="fas fa-server" style="color: white;"></i>
                                        <div style="font-size: 0.8em; margin-top: 5px;">Core Switch</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <div class="col-auto">
                                    <div class="network-node" style="background: var(--accent-green); padding: 10px; border-radius: 50%; margin: 10px;">
                                        <i class="fas fa-shield-alt" style="color: white;"></i>
                                        <div style="font-size: 0.8em; margin-top: 5px;">Firewall</div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="network-node" style="background: var(--accent-orange); padding: 10px; border-radius: 50%; margin: 10px;">
                                        <i class="fas fa-eye" style="color: white;"></i>
                                        <div style="font-size: 0.8em; margin-top: 5px;">IDS/IPS</div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="network-node" style="background: var(--accent-purple); padding: 10px; border-radius: 50%; margin: 10px;">
                                        <i class="fas fa-database" style="color: white;"></i>
                                        <div style="font-size: 0.8em; margin-top: 5px;">Database</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <div class="fw-bold" style="color: var(--accent-green);">24</div>
                                <small class="text-muted">Active Nodes</small>
                            </div>
                            <div class="col-4">
                                <div class="fw-bold" style="color: var(--accent-orange);">2</div>
                                <small class="text-muted">Warning Nodes</small>
                            </div>
                            <div class="col-4">
                                <div class="fw-bold" style="color: var(--accent-red);">1</div>
                                <small class="text-muted">Critical Nodes</small>
                            </div>
                        </div>
                    </div>
                `,
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-blue)',
                width: '600px'
            });
        }

        // Real-time monitoring functions
        function enableRealTimeAlerts() {
            Swal.fire({
                title: 'Real-time Alerts Enabled',
                text: 'You will now receive real-time notifications for critical security events.',
                icon: 'success',
                background: 'var(--secondary-dark)',
                color: 'var(--text-primary)',
                confirmButtonColor: 'var(--accent-green)',
                timer: 3000,
                timerProgressBar: true
            });

            // Simulate real-time alert after some time
            setTimeout(() => {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 5000,
                    timerProgressBar: true
                });

                Toast.fire({
                    icon: 'warning',
                    title: 'Security Alert',
                    text: 'Suspicious login attempt detected',
                    background: 'var(--accent-red)',
                    color: 'white'
                });
            }, 10000);
        }

        // Utility function to add interactive tooltips
        function initializeTooltips() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.socDashboard = new SOCDashboard();
            initializeTooltips();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl+Shift+S for search
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    document.getElementById('searchQuery').focus();
                }
                
                // Ctrl+Shift+A for alerts
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    window.location.href = '/alerts';
                }
                
                // Ctrl+Shift+T for threat intelligence
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    showThreatIntel();
                }
                
                // Ctrl+Shift+I for incident response
                if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                    e.preventDefault();
                    showIncidentResponse();
                }
                
                // Ctrl+Shift+C for correlation engine
                if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                    e.preventDefault();
                    showCorrelationRules();
                }
                
                // Ctrl+Shift+R to refresh dashboard
                if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                    e.preventDefault();
                    window.socDashboard.refreshAllData();
                    
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 2000,
                        timerProgressBar: true
                    });
                    
                    Toast.fire({
                        icon: 'success',
                        title: 'Dashboard refreshed',
                        background: 'var(--secondary-dark)',
                        color: 'var(--text-primary)'
                    });
                }
            });
            
            // Show keyboard shortcuts help
            const helpText = `
                <div class="text-start">
                    <h6 class="mb-3">Keyboard Shortcuts:</h6>
                    <ul class="list-unstyled">
                        <li><kbd>Ctrl+Shift+S</kbd> - Focus Search</li>
                        <li><kbd>Ctrl+Shift+A</kbd> - Open Alerts</li>
                        <li><kbd>Ctrl+Shift+T</kbd> - Threat Intelligence</li>
                        <li><kbd>Ctrl+Shift+I</kbd> - Incident Response</li>
                        <li><kbd>Ctrl+Shift+C</kbd> - Correlation Engine</li>
                        <li><kbd>Ctrl+Shift+R</kbd> - Refresh Dashboard</li>
                    </ul>
                </div>
            `;
            
            // Add help button tooltip
            const helpButton = document.createElement('button');
            helpButton.className = 'btn btn-outline-info btn-sm position-fixed';
            helpButton.style.cssText = 'bottom: 20px; right: 20px; z-index: 1000; border-radius: 50%; width: 40px; height: 40px;';
            helpButton.innerHTML = '<i class="fas fa-question"></i>';
            helpButton.onclick = () => {
                Swal.fire({
                    title: 'Dashboard Help',
                    html: helpText,
                    background: 'var(--secondary-dark)',
                    color: 'var(--text-primary)',
                    confirmButtonColor: 'var(--accent-blue)',
                    width: '400px'
                });
            };
            document.body.appendChild(helpButton);
            
            // Welcome message for first-time users
            if (!localStorage.getItem('socDashboardVisited')) {
                setTimeout(() => {
                    Swal.fire({
                        title: 'Welcome to SOC Dashboard',
                        html: `
                            <div class="text-start">
                                <p>Welcome to the Enterprise Security Operations Center Dashboard!</p>
                                <p><strong>Features:</strong></p>
                                <ul>
                                    <li>Real-time threat monitoring</li>
                                    <li>Advanced correlation engine</li>
                                    <li>Incident response automation</li>
                                    <li>Threat intelligence integration</li>
                                    <li>Interactive analytics</li>
                                </ul>
                                <p>Use keyboard shortcuts or click the <i class="fas fa-question"></i> button for help.</p>
                            </div>
                        `,
                        icon: 'info',
                        background: 'var(--secondary-dark)',
                        color: 'var(--text-primary)',
                        confirmButtonColor: 'var(--accent-blue)',
                        confirmButtonText: 'Get Started',
                        width: '500px'
                    });
                    localStorage.setItem('socDashboardVisited', 'true');
                }, 2000);
            }
        });
    </script>
</body>
</html>
